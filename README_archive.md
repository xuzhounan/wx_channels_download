# 微信视频号自动归档下载器

## 🆕 新增功能

### ✨ 自动按用户归档
- 📁 **自动创建用户文件夹**：按照视频作者昵称自动创建子目录
- 🏷️ **智能文件命名**：使用视频标题作为文件名，自动清理非法字符
- 🔄 **重复检测**：自动跳过已下载的视频，避免重复下载

### 📁 目录结构示例
```
/Users/xzn/Desktop/视频号下载/
├── 形象力程成/
│   ├── 女性独立最重要的是形象独立 #形象力程成 #审美 #美学 #形象 #女性成长.mp4
│   └── 婚姻不幸会代际传递给下一代_#形象力程成#美学#审美#形象#女性成长_.mp4
├── 另一个用户/
│   ├── 视频1.mp4
│   └── 视频2.mp4
└── 未知用户/
    └── 未识别用户的视频.mp4
```

## 🚀 使用方法

### 基本启动
```bash
# 启动自动归档下载
sudo ./wx_video_download_archive --auto --download-dir="/Users/xzn/Desktop/视频号下载"
```

### 完整参数
```bash
sudo ./wx_video_download_archive \
  --auto \
  --download-dir="/path/to/download" \
  --port=2023 \
  --dev=Wi-Fi
```

## ✅ 功能特性

### 🎯 自动化功能
- ✅ **完全自动**：浏览视频时自动下载，无需手动操作
- ✅ **智能归档**：按用户名自动创建文件夹
- ✅ **重复跳过**：检测已存在文件，自动跳过重复下载
- ✅ **加密解密**：自动检测并解密加密视频

### 📂 文件管理
- ✅ **安全文件名**：自动清理文件名中的非法字符
- ✅ **目录自动创建**：自动创建下载目录和用户子目录
- ✅ **多重检测**：基于文件名和视频ID双重重复检测

### 🔒 数据完整性
- ✅ **视频解密**：支持加密视频的自动解密
- ✅ **图片支持**：支持图片内容的批量下载
- ✅ **元数据保存**：保存视频作者信息和ID

## 📊 日志输出示例
```
[自动下载] 开始下载到用户目录: 形象力程成/女性独立最重要的是形象独立
[自动下载] 用户: 形象力程成 (ID: v2_060000231...)
[自动下载] 下载并解密完成: /Users/xzn/Desktop/视频号下载/形象力程成/女性独立最重要的是形象独立.mp4
[自动下载] 文件已存在，跳过: /Users/xzn/Desktop/视频号下载/形象力程成/同一个视频.mp4
```

## 🛡️ 重复检测机制
1. **文件名检测**：检查基于标题的文件是否已存在
2. **视频ID检测**：检查基于视频ID的文件是否已存在
3. **跳过提示**：发现重复时显示跳过信息

## ⚙️ 高级配置

### 文件命名规则
- 优先使用视频标题作为文件名
- 标题为空时使用视频ID
- 都为空时使用时间戳
- 自动清理非法字符：`< > : " / \ | ? *`

### 用户目录规则
- 优先使用用户昵称作为文件夹名
- 昵称为空时使用"未知用户"
- 自动清理文件夹名中的非法字符

## 🎉 使用体验
启动程序后，只需正常浏览微信视频号：
1. 程序自动检测视频信息
2. 自动创建用户文件夹
3. 检测是否重复，跳过已下载的视频  
4. 自动下载新视频到对应用户文件夹
5. 加密视频自动解密保存

完全解放双手，实现真正的自动化批量下载和归档！